<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>PhishGuard ‚Äî Safe Link Detector</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(120deg, #c8f0ff, #e0ffe5);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
    }
    .navbar {
      background-color: #ffffffcc;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      backdrop-filter: blur(5px);
    }
    .hero {
      text-align: center;
      padding: 60px 20px;
    }
    .hero h1 {
      font-weight: 700;
      color: #0056b3;
    }
    .hero p {
      color: #444;
      font-size: 18px;
    }
    .app-card {
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 35px rgba(20,30,60,0.08);
      background-color: white;
    }
    .result-img {
      width: 140px;
      height: 140px;
      object-fit: contain;
      border-radius: 16px;
      animation: fadeIn 0.8s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    .btn-primary {
      background: linear-gradient(90deg,#007bff,#00aaff);
      border: none;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg,#006be6,#0091dd);
    }
    .safe-banner {
      background: #d7f9e5;
      border-left: 5px solid #00c46b;
    }
    .unsafe-banner {
      background: #ffe0e0;
      border-left: 5px solid #ff4d4d;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="/static/logo.png" width="48" class="me-2">
        <strong>PhishGuard</strong>
      </a>
    </div>
  </nav>

  <!-- Hero section -->
  <section class="hero">
    <img src="/static/shield.png" width="100" class="mb-3">
    <h1>Check Links Before You Click üõ°Ô∏è</h1>
    <p>PhishGuard uses AI to detect phishing or unsafe websites ‚Äî and alerts you instantly via Telegram.</p>
  </section>

  <!-- Main form -->
  <div class="container pb-5">
    <div class="row justify-content-center">
      <div class="col-lg-7 col-md-9">
        <div class="app-card">
          <form id="checkForm" class="row g-3">
            <div class="col-12">
              <input id="urlInput" name="url" class="form-control form-control-lg" placeholder="Paste URL (include http/https)" required>
            </div>
            <div class="col-md-8">
              <input id="telegramIdInput" name="telegram_chat_id" class="form-control" placeholder="Telegram chat id (optional)">
              <small class="form-text text-muted">If empty, the server uses its default Chat ID.</small>
            </div>
            <div class="col-md-4 d-grid">
              <button type="submit" class="btn btn-primary btn-lg">üîç Check Link</button>
            </div>
          </form>

          <!-- Spinner -->
          <div id="spinnerArea" class="text-center mt-4" style="display:none;">
            <div class="spinner-border text-primary" role="status"></div>
            <div class="mt-2 text-muted">Analyzing link...</div>
          </div>

          <!-- Result Section -->
          <div id="resultCard" class="mt-4" style="display:none;">
            <div class="card p-3">
              <div class="d-flex flex-column align-items-center text-center">
                <img id="resultImg" class="result-img mb-3" src="/static/safe.png" alt="result">
                <h4 id="resultTitle"></h4>
                <p id="resultText" class="lead"></p>
                <p id="probText" class="text-muted"></p>
              </div>
              <div id="actionArea" class="mt-3 text-center"></div>
              <div id="alertArea" class="mt-3 text-center"></div>
            </div>
          </div>

          <p class="small text-muted mt-4 text-center">
            Tip: Make sure your Telegram bot is started before checking.  
            <br>Use realistic URLs for best detection results.
          </p>
        </div>
      </div>
    </div>
  </div>

<script>
const form = document.getElementById('checkForm');
const spinnerArea = document.getElementById('spinnerArea');
const resultCard = document.getElementById('resultCard');
const resultImg = document.getElementById('resultImg');
const resultTitle = document.getElementById('resultTitle');
const resultText = document.getElementById('resultText');
const probText = document.getElementById('probText');
const actionArea = document.getElementById('actionArea');
const alertArea = document.getElementById('alertArea');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  resultCard.style.display = 'none';
  spinnerArea.style.display = 'block';
  alertArea.innerHTML = '';
  actionArea.innerHTML = '';

  const url = document.getElementById('urlInput').value.trim();
  const telegram_chat_id = document.getElementById('telegramIdInput').value.trim();

  const fd = new FormData();
  fd.append('url', url);
  if (telegram_chat_id) fd.append('telegram_chat_id', telegram_chat_id);

  try {
    const res = await fetch('/check_url', { method: 'POST', body: fd });
    const data = await res.json();
    spinnerArea.style.display = 'none';
    resultCard.style.display = 'block';

    if (data.error) {
      resultImg.src = '/static/unsafe.png';
      resultTitle.innerText = '‚ö†Ô∏è Error Occurred';
      resultText.innerText = data.error;
      probText.innerText = '';
      actionArea.innerHTML = `<button class="btn btn-outline-secondary" onclick="dismiss()">Close</button>`;
      return;
    }

    const isUnsafe = data.is_unsafe;
    if (!isUnsafe) {
      resultImg.src = '/static/safe_banner.png';
      resultTitle.innerText = '‚úÖ Safe to Visit';
      resultText.innerText = `The website appears legitimate: ${data.url}`;
      probText.innerText = data.probability ? `Confidence: ${data.probability}%` : '';
      actionArea.innerHTML = `
        <button class="btn btn-success" onclick="proceed('${data.url}')">Visit Site</button>
        <button class="btn btn-outline-secondary ms-2" onclick="dismiss()">Cancel</button>
      `;
    } else {
      resultImg.src = '/static/unsafe_banner.png';
      resultTitle.innerText = 'üö® Unsafe / Phishing Detected';
      resultText.innerText = `Warning: ${data.url} may be malicious or fake.`;
      probText.innerText = data.probability ? `Confidence: ${data.probability}%` : '';
      actionArea.innerHTML = `<button class="btn btn-outline-danger" onclick="dismiss()">OK</button>`;
      alertArea.innerHTML = data.telegram_sent
        ? `<div class="alert alert-danger mt-3">üö® Telegram Alert Sent! ${data.telegram_message}</div>`
        : `<div class="alert alert-warning mt-3">‚ö†Ô∏è ${data.telegram_message}</div>`;
    }
  } catch (err) {
    spinnerArea.style.display = 'none';
    resultCard.style.display = 'block';
    resultImg.src = '/static/unsafe.png';
    resultTitle.innerText = '‚ö†Ô∏è Error';
    resultText.innerText = err.message || 'Unexpected error';
    probText.innerText = '';
    actionArea.innerHTML = `<button class="btn btn-outline-secondary" onclick="dismiss()">Close</button>`;
  }
});

function proceed(link) {
  if (confirm("Open this link in a new tab?")) window.open(link, "_blank");
}
function dismiss() {
  resultCard.style.display = 'none';
}
</script>
</body>
</html>
